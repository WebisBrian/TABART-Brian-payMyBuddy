<!doctype html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Transférer</title>
</head>
<body>

<nav>
    <a href="/transactions">Transférer</a>
    <a href="/profile">Profil</a>
    <a href="/contacts">Ajouter relation</a>

    <form th:action="@{/logout}" method="post" style="display:inline;">
        <input type="hidden"
               th:name="${_csrf.parameterName}"
               th:value="${_csrf.token}"/>
        <button type="submit">Se déconnecter</button>
    </form>
</nav>

<main>
    <h1>Transférer</h1>

    <!--  Error message  -->
    <div th:if="${transferError}" style="color: red; margin: 10px 0;">
        <p th:text="${transferError}"></p>
    </div>

    <!--  Transfer form  -->
    <form th:action="@{/transactions/transfer(userId=${param.userId})}"
          th:object="${transferForm}"
          method="post">

        <!-- Recipient -->
        <div>
            <label for="receiverId">Sélectionner une relation</label>
            <select id="receiverId" th:field="*{receiverId}">
                <option th:each="c : ${contacts}"
                        th:value="${c.id}"
                        th:text="|${c.username} (${c.email})|">
                </option>
            </select>

            <div th:if="${#fields.hasErrors('receiverId')}" style="color:red;">
                <span th:errors="*{receiverId}">Erreur destinataire</span>
            </div>
        </div>

        <!-- Description -->
        <div>
            <label for="description">Description</label>
            <input id="description" type="text" th:field="*{description}" placeholder="Description"/>

            <div th:if="${#fields.hasErrors('description')}" style="color:red;">
                <span th:errors="*{description}">Erreur description</span>
            </div>
        </div>

        <!-- Amount -->
        <div>
            <label for="amount">Montant (€)</label>
            <input id="amount" type="number" step="0.01" min="0.01" th:field="*{amount}" placeholder="0.00"/>

            <div th:if="${#fields.hasErrors('amount')}" style="color:red;">
                <span th:errors="*{amount}">Erreur montant</span>
            </div>
        </div>

        <div>
            <button type="submit">Payer</button>
        </div>
    </form>

    <!-- Transaction history -->
    <section style="margin-top: 30px;">
        <h2>Mes Transactions</h2>

        <table border="1" cellpadding="6" cellspacing="0">
            <thead>
            <tr>
                <th>Date</th>
                <th>Relation</th>
                <th>Type</th>
                <th>Description</th>
                <th>Montant</th>
                <th>Frais</th>
            </tr>
            </thead>

            <tbody>
            <tr th:if="${transactionRows == null || transactionRows.content == null || transactionRows.content.isEmpty()}">
                <td colspan="6">Aucune transaction</td>
            </tr>

            <tr th:each="row : ${transactionRows.content}">
                <td th:text="${row.date}">2026-01-01T12:00</td>
                <td th:text="${row.counterpartyLabel}">Alice (alice@mail.com)</td>
                <td th:text="${row.directionLabel}">Envoyé</td>
                <td th:text="${row.description}">Description</td>

                <!-- Montant signé -->
                <td th:text="${row.signedAmount}"
                    th:style="${row.signedAmount.signum() < 0} ? 'color:red' : 'color:green'">
                    -15.00
                </td>

                <td th:text="${row.direction.name() == 'SENT' ? row.fee : '—'}">0.00</td>
            </tr>
            </tbody>
        </table>

        <!-- Pagination -->
        <div style="margin-top: 10px;" th:if="${transactionRows != null}">
            <a th:if="${transactionRows.hasPrevious()}"
               th:href="@{/transactions(userId=${param.userId}, page=${transactionRows.number - 1}, size=${transactionRows.size})}">
                Précédent
            </a>

            <span th:text="${transactionRows.totalPages == 0
                ? '0 / 0'
                : (transactionRows.number + 1) + ' / ' + transactionRows.totalPages}">
            1 / 1
        </span>

            <a th:if="${transactionRows.hasNext()}"
               th:href="@{/transactions(userId=${param.userId}, page=${transactionRows.number + 1}, size=${transactionRows.size})}">
                Suivant
            </a>
        </div>
    </section>


</main>

</body>
</html>